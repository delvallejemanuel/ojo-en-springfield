<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Ojo en Springfield</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Nunito:wght@700;900&display=swap');
        :root { --yellow:#FFD90F; --blue:#1565C0; --dark:#0d0d0d; --red:#E53935; --green:#2E7D32; }
        * { box-sizing:border-box; margin:0; padding:0; }
        body { background:var(--dark); background-image:radial-gradient(ellipse at 50% 0%,#1a2a1a 0%,#0d0d0d 70%); color:white; font-family:'Nunito',sans-serif; min-height:100vh; padding:16px; }

        .page-layout { display:flex; gap:20px; justify-content:center; align-items:flex-start; width:100%; max-width:900px; margin:0 auto; }
        .game-col { display:flex; flex-direction:column; align-items:center; flex:1; min-width:0; max-width:560px; }
        .ranking-col { width:220px; flex-shrink:0; }

        .stats-bar { display:flex; justify-content:space-between; align-items:center; width:100%; margin-bottom:10px; background:rgba(255,217,15,0.1); border:2px solid rgba(255,217,15,0.3); border-radius:12px; padding:8px 18px; font-family:'Bangers',cursive; font-size:1.3rem; letter-spacing:1px; color:var(--yellow); }
        h1 { font-family:'Bangers',cursive; color:var(--yellow); text-shadow:3px 3px 0 #000,-1px -1px 0 #000; font-size:2rem; letter-spacing:3px; text-align:center; margin-bottom:14px; }
        .tv-wrap { width:100%; }
        .tv-frame { position:relative; background:#2a2a2a; border:16px solid #3a3a3a; border-radius:28px; overflow:hidden; box-shadow:0 0 40px rgba(0,0,0,0.8),inset 0 0 20px rgba(0,0,0,0.5); }
        .screen { width:100%; aspect-ratio:4/3; background:#111; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; }
        .scanlines { position:absolute; inset:0; background:repeating-linear-gradient(to bottom,transparent 0px,transparent 2px,rgba(0,0,0,0.15) 2px,rgba(0,0,0,0.15) 4px); pointer-events:none; z-index:3; }
        #episode-img { width:100%; height:100%; object-fit:cover; display:none; animation:fadeIn 0.4s ease; z-index:2; }
        @keyframes fadeIn { from{opacity:0} to{opacity:1} }
        #loader { font-family:'Bangers',cursive; font-size:1.4rem; color:var(--yellow); letter-spacing:3px; text-align:center; padding:20px; animation:blink 0.8s step-start infinite; }
        @keyframes blink { 50%{opacity:0} }

        #game-over-overlay { position:absolute; inset:0; background:rgba(0,0,0,0.95); display:none; flex-direction:column; align-items:center; justify-content:center; z-index:20; text-align:center; padding:20px; }
        #game-over-overlay h2 { font-family:'Bangers',cursive; color:var(--red); font-size:2.5rem; letter-spacing:2px; margin-bottom:6px; }

        .hint-text { text-align:center; font-size:0.8rem; color:#888; letter-spacing:2px; text-transform:uppercase; margin:10px 0 10px; width:100%; }
        .opciones-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; width:100%; margin-top:4px; }
        .opcion-btn { background:#1a1a1a; border:3px solid #444; border-radius:10px; color:white; font-family:'Nunito',sans-serif; font-size:0.82rem; font-weight:700; padding:12px 10px; cursor:pointer; transition:border-color 0.15s, background 0.15s, transform 0.1s; text-align:center; line-height:1.3; min-height:56px; display:flex; align-items:center; justify-content:center; }
        .opcion-btn:hover:not(:disabled) { border-color:var(--yellow); background:#1a2a1a; transform:translateY(-1px); }
        .opcion-btn:disabled { cursor:not-allowed; }
        .opcion-btn.correcto { border-color:#4CAF50 !important; background:#1b3a1b !important; color:#4CAF50; }
        .opcion-btn.incorrecto { border-color:var(--red) !important; background:#3a1b1b !important; color:var(--red); }
        .opcion-btn.revelar { border-color:#4CAF50 !important; background:#1b3a1b !important; color:#4CAF50; animation: pulse-green 0.5s ease; }
        @keyframes pulse-green { 0%{box-shadow:0 0 0 0 rgba(76,175,80,0.6)} 70%{box-shadow:0 0 0 10px rgba(76,175,80,0)} 100%{box-shadow:0 0 0 0 rgba(76,175,80,0)} }
        #feedback { margin-top:10px; font-family:'Bangers',cursive; font-size:1.3rem; letter-spacing:1px; min-height:2em; text-align:center; line-height:1.3; width:100%; }

        /* ‚îÄ‚îÄ SINOPSIS ‚îÄ‚îÄ */
        #sinopsis-box {
            display: none;
            width: 100%;
            margin-top: 10px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,217,15,0.2);
            border-radius: 10px;
            padding: 12px 14px;
            animation: fadeIn 0.4s ease;
        }
        #sinopsis-box .sinopsis-label {
            font-family: 'Bangers', cursive;
            color: var(--yellow);
            font-size: 0.85rem;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        #sinopsis-texto {
            font-size: 0.78rem;
            color: #bbb;
            line-height: 1.5;
        }

        .btn-reintentar { background:var(--yellow); color:#000; border:3px solid #000; padding:12px 28px; font-family:'Bangers',cursive; font-size:1.3rem; letter-spacing:2px; cursor:pointer; border-radius:8px; }

        .ranking-box { background:rgba(255,217,15,0.07); border:2px solid rgba(255,217,15,0.3); border-radius:14px; padding:14px 12px; position:sticky; top:16px; }
        .ranking-box h2 { font-family:'Bangers',cursive; color:var(--yellow); font-size:1.3rem; letter-spacing:2px; text-align:center; margin-bottom:12px; border-bottom:2px solid rgba(255,217,15,0.2); padding-bottom:8px; }
        .rank-list { list-style:none; }

        #name-screen { position:fixed; inset:0; background:rgba(0,0,0,0.97); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:200; text-align:center; padding:24px; }
        #name-screen h2 { font-family:'Bangers',cursive; color:var(--yellow); font-size:2.2rem; letter-spacing:3px; margin-bottom:8px; text-shadow:3px 3px 0 #000; }
        #name-screen p { color:#aaa; margin-bottom:20px; font-size:0.95rem; }
        #name-screen-input { background:#1a1a1a; border:3px solid var(--yellow); border-radius:10px; color:white; font-family:'Nunito',sans-serif; font-size:1.1rem; font-weight:700; padding:13px 18px; outline:none; width:100%; max-width:280px; text-align:center; margin-bottom:14px; }
        #name-screen-input::placeholder { color:#555; }
        .btn-jugar { background:var(--yellow); color:#000; border:3px solid #000; padding:13px 36px; font-family:'Bangers',cursive; font-size:1.4rem; letter-spacing:2px; cursor:pointer; border-radius:10px; transition:transform 0.1s; }
        .btn-jugar:hover { transform:translateY(-2px); }

        @media (max-width: 700px) {
            .page-layout { flex-direction:column; align-items:center; }
            .ranking-col { width:100%; max-width:560px; }
            .ranking-box { position:static; }
            #sinopsis-texto { font-size: 0.75rem; }
        }
    </style>
</head>
<body>

<div id="name-screen">
    <h2>üéØ EL OJO EN SPRINGFIELD</h2>
    <p>¬øC√≥mo te llam√°s, fan√°tico/a?</p>
    <input id="name-screen-input" type="text" maxlength="18" placeholder="Tu nombre o apodo..." autocomplete="off"
        onkeydown="if(event.key==='Enter') confirmarNombre()">
    <button class="btn-jugar" onclick="confirmarNombre()">¬°A JUGAR!</button>
</div>

<div class="page-layout">
    <div class="game-col">
        <div class="stats-bar">
            <div>VIDAS: <span id="lives">üç©üç©üç©üç©üç©</span></div>
            <div>PUNTOS: <span id="score">0</span></div>
            <button onclick="terminarPartida()" style="background:var(--red);color:white;border:2px solid rgba(255,255,255,0.3);border-radius:8px;padding:6px 12px;font-family:'Bangers',cursive;font-size:1rem;letter-spacing:1px;cursor:pointer;">üè≥Ô∏è TERMINAR</button>
        </div>
        <h1>üéØ EL OJO EN SPRINGFIELD</h1>
        <div id="player-tag" style="text-align:center;font-size:0.78rem;color:#777;margin-bottom:8px;width:100%;"></div>
        <div class="tv-wrap">
            <div class="tv-frame">
                <div class="scanlines"></div>
                <div class="screen">
                    <div id="loader">SINTONIZANDO...</div>
                    <img id="episode-img" alt="Captura del episodio">
                    <div id="game-over-overlay">
                        <h2>¬°FIN DEL JUEGO!</h2>
                        <div style="color:var(--yellow);font-family:'Bangers',cursive;font-size:2rem;margin-bottom:14px;">üç© <span id="final-score">0</span> pts</div>
                        <div style="font-size:0.85rem;color:#aaa;letter-spacing:1px;text-transform:uppercase;margin-bottom:6px;">Guardando como:</div>
                        <input id="nombre-input" type="text" maxlength="18" placeholder="Tu nombre..."
                            style="background:#1a1a1a;border:3px solid var(--yellow);border-radius:8px;color:white;font-family:'Nunito',sans-serif;font-size:1rem;font-weight:700;padding:10px 14px;outline:none;width:100%;max-width:240px;text-align:center;margin-bottom:14px;"
                            autocomplete="off" onkeydown="if(event.key==='Enter') guardarYReiniciar()">
                        <div id="save-status" style="font-size:0.8rem;color:#aaa;margin-bottom:10px;min-height:1.2em;"></div>
                        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
                            <button onclick="guardarYReiniciar()" style="background:#2E7D32;color:white;border:3px solid rgba(255,255,255,0.3);padding:11px 22px;font-family:'Bangers',cursive;font-size:1.2rem;letter-spacing:1px;cursor:pointer;border-radius:8px;">üíæ GUARDAR</button>
                            <button class="btn-reintentar" onclick="reiniciarJuego()">‚Ü© SIN GUARDAR</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <p class="hint-text">¬øDe qu√© episodio es esta escena?</p>
        <div class="opciones-grid" id="opciones-grid"></div>
        <div id="feedback"></div>
        <div id="sinopsis-box">
            <div class="sinopsis-label">üì∫ DE QU√â VA EL CAP√çTULO</div>
            <div id="sinopsis-texto"></div>
        </div>
    </div>

    <div class="ranking-col">
        <div class="ranking-box">
            <h2>üèÜ RANKING</h2>
            <ul class="rank-list" id="rank-list">
                <li style="text-align:center;color:#555;font-size:0.8rem;padding:20px 0;">Cargando...</li>
            </ul>
        </div>
    </div>
</div>

<script>
const JSONBIN_ID  = '6997c294d0ea881f40c85980';
const JSONBIN_KEY = '$2a$10$OYxEVve02oNpJtLc6AlEDeClX5rw0Yd2u6pfl5IdZ1DxjQCXRqF/q';
const BIN_URL     = `https://api.jsonbin.io/v3/b/${JSONBIN_ID}`;
const MAX_ENTRIES = 10;

const traduccion = {
    "Simpsons Roasting on an Open Fire": "Especial de Navidad de los Simpson","Bart the Genius": "Bart es un genio","Homer's Odyssey": "La odisea de Homero","There's No Disgrace Like Home": "La familia va a terapia","Bart the General": "Bart el General","Moaning Lisa": "La depresi√≥n de Lisa","The Call of the Simpsons": "La llamada de los Simpson","The Telltale Head": "El h√©roe sin cabeza","Life on the Fast Lane": "Un momento de decisi√≥n","Homer's Night Out": "La noche de fiesta de Homero","The Crepes of Wrath": "Intercambio cultural","Krusty Gets Busted": "Krusty va a la c√°rcel","Some Enchanted Evening": "Una noche encantadora","Bart Gets an F": "Bart reprueba","Simpson and Delilah": "simpson y dalilah","Treehouse of Horror": "Especial de noche de brujas","Two Cars in Every Garage and Three Eyes on Every Fish": "Dos coches en cada garaje y tres ojos en cada pez","Dancin' Homer": "Homero el animador","Dead Putting Society": "la sociedad de los golfistas muertos","Bart vs. Thanksgiving": "Bart contra el d√≠a de gracias","Bart the Daredevil": "Bart el temerario","Itchy & Scratchy & Marge": "Tomy, Daly y Marge","Bart Gets Hit by a Car": "Bart es atropellado","One Fish, Two Fish, Blowfish, Blue Fish": "Aviso de muerte","The Way We Was": "los a√±os que vivimos","Homer vs. lisa and the 8th commandment": "no robaras","Principal Charming": "El director encantador","Oh Brother, Where Art Thou?": "¬øD√≥nde est√°s hermano m√≠o?","Bart's Dog Gets an F": "El perro de bart reprueba","Old Money": "nuestros a√±os felices","Brush with Greatness": "pinceles con grandeza","Lisa's Substitute": "El sustituto de Lisa","The War of the Simpsons": "La guerra de los Simpson","Three Men and a Comic Book": "Tres hombres y una historieta","Blood Feud": "Sangre nueva","Stark Raving Dad": "Pap√° est√° loco","Mr. Lisa Goes to Washington": "El patriotismo de Lisa","When Flanders Failed": "el dia que cay√≥ flanders","Bart the Murderer": "el peque√±o padrino","Homer Defined": "homero al diccionario","Like Father, Like Clown": "De tal padre tal payaso","Treehouse of Horror II": "Especial de noche de brujas II","Lisa's Pony": "El pony de Lisa","Saturdays of Thunder": "S√°bados de trueno","Flaming Moe's": "Llamarada Moe","Burns Verkaufen der Kraftwerk": "Burns y los alemanes","I Married Marge": "Me cas√© con Marge","Radio Bart": "bart y la radio","Lisa the Greek": "los pronosticos de lisa","Homer Alone": "Homero se queda solo","Bart the Lover": "Bart el amante","Homer at the Bat": "Homero al bat","Separate Vocations": "Vocaciones distintas","Dog of Death": "nuestro mejor amigo","Colonel Homer": "homero el campirano","Black Widower": "El viudo negro","The Otto Show": "El rock de Otto","Bart's Friend Falls in Love": "milhouse se enamora","Brother, Can You Spare Two Dimes?": "hermano, podrias darme dinero?","Kamp Krusty": "Kampamento Krusty","A Streetcar Named Marge": "Un tranv√≠a llamado Marge","Homer the Heretic": "Homero el hereje","Lisa the Beauty Queen": "Lisa la reina de la belleza","Treehouse of Horror III": "Especial de noche de brujas III","Itchy & Scratchy: The Movie": "tomy y daly: La pel√≠cula","Marge Gets a Job": "Marge consigue un empleo","New Kid on the Block": "La chica nueva","Mr. Plow": "Don Barredora","Lisa's First Word": "La primera palabra de lisa","Homer's Triple Bypass": "El gran coraz√≥n de Homero","Marge vs. the Monorail": "Marge contra el monorriel","Selma's Choice": "La elecci√≥n de Selma","Brother from the Same Planet": "Hermano menor, Hermano mayor","I Love Lisa": "Yo amo a Lisa","Duffless": "la promesa","Last Exit to Springfield": "La √∫ltima salida a Springfield","So It's Come to This: A Simpsons Clip Show": "A esto hemos llegado","The Front": "el intermedio","Whacking Day": "El d√≠a del garrote","Marge in Chains": "Marge en cadenas","Krusty Gets Kancelled": "El drama de Krusty","Homer's Barbershop Quartet": "El cuarteto de Homero","Cape Feare": "Cabo de miedosos","Homer Goes to College": "Homero va a la universidad","Rosebud": "El oso de Burns","Treehouse of Horror IV": "Especial de noche de brujas IV","Marge on the Lam": "Marge la rebelde","Bart's Inner Child": "Filosof√≠a bartiana","Boy-Scoutz 'n the Hood": "Exploradores a la fuerza","The Last Temptation of Homer": "La √∫ltima tentaci√≥n de Homero","$pringfield (Or, How I Learned to Stop Worrying and Love Legalized Gambling)": "Springfield pr√≥spero","Homer the Vigilante": "Homero el vigilante","Bart Gets Famous": "Bart se hace famoso","Homer and Apu": "homero y apu","Lisa vs. Malibu Stacy": "Lisa contra la Baby Malib√∫","Deep Space Homer": "Homero en el espacio profundo","Homer Loves Flanders": "Homero ama a Flanders","Bart Gets an Elephant": "Bart gana un elefante","Burns' Heir": "El heredero de Burns","Sweet Seymour Skinner's Baadasssss Song": "La canci√≥n de Skinner","The Boy Who Knew Too Much": "El ni√±o que sab√≠a demasiado","Lady Bouvier's Lover": "El amante de Lady Bouvier","Secrets of a Successful Marriage": "Secretos de un buen matrimonio","Bart of Darkness": "el diabolico bart","Lisa's Rival": "La rival de Lisa","Another Simpsons Clip Show": "recuerdos de amor","Itchy & Scratchy Land": "La tierra de Tomy y Daly","Sideshow Bob Roberts": "El regreso de Bob Pati√±o","Treehouse of Horror V": "Especial de noche de brujas V","Bart's Girlfriend": "La novia de Bart","Lisa on Ice": "Lisa y los deportes","Homer Badman": "Homero el malo","Grandpa vs. Sexual Inadequacy": "El abuelo contra la impotencia sexual","Fear of Flying": "Miedo a volar","Homer the Great": "Homero el Grande","And Maggie Makes Three": "y con maggie son tres","Bart's Comet": "El cometa de Bart","Homie the Clown": "Homero el payaso","Bart vs. Australia": "Bart contra Australia","Homer vs. Patty and Selma": "Homero contra Patty y Selma","A Star Is Burns": "Una estrella estrellada","Lisa's Wedding": "La boda de Lisa","Two Dozen and One Greyhounds": "Un galgo llamado Monty","The PTA Disbands": "lucha educativa","'Round Springfield": "por la cuidad de springfield","The Springfield Connection": "contacto en springfield","Lemon of Troy": "El limonero de Troya","Who Shot Mr. Burns? (Part One)": "¬øQui√©n mat√≥ al Sr. Burns? (Parte 1)","Who Shot Mr. Burns? (Part Two)": "¬øQui√©n mat√≥ al Sr. Burns? (Parte 2)","Radioactive Man": "hombre radiactivo","Home Sweet Homediddly-Dum-Doodily": "Hogar dulce hogarcirijillo","Bart Sells His Soul": "Bart vende su alma","Lisa the Vegetarian": "Lisa la vegetariana","Treehouse of Horror VI": "Especial de noche de brujas VI","King-Size Homer": "Homero tama√±o familiar","Mother Simpson": "Mam√° simpson","Sideshow Bob's Last Gleaming": "la ultima carcajada de Bob Pati√±o","The Simpsons 138th Episode Spectacular": "El espectacular episodio 138 de los Simpson","Marge Be Not Proud": "el beb√© de mam√°","Team Homer": "El equipo de Homero","Two Bad Neighbors": "Dos malos vecinos","Scenes from the Class Struggle in Springfield": "lucha de clases en Springfield","Bart the Fink": "Bart el sopl√≥n","Lisa the Iconoclast": "Lisa la iconoclasta","Homer the Smithers": "Homero el Smithers","The Day the Violence Died": "El d√≠a que muri√≥ la violencia","A Fish Called Selma": "Un pez llamado Selma","Bart on the Road": "Bart recorre el mundo","22 Short Films About Springfield": "22 pel√≠culas cortas sobre Springfield","Raging Abe Simpson and His Grumbling Grandson in 'The Curse of the Flying Hellfish'": "Mi h√©roe el abuelo","Much Apu About Nothing": "y donde esta el inmigrante?","Homerpalooza": "Homeropalooza","Summer of 4 Ft. 2": "Verano de metro y medio","Treehouse of Horror VII": "Especial de noche de brujas VII","You Only Move Twice": "Solo se muda dos veces","The Homer They Fall": "Homero por el campeonato","Treehouse of Horror VIII": "Especial de noche de brujas VIII","Burns, Baby Burns": "Papi burns","Bart After Dark": "bart de noche","A Milhouse Divided": "Milhouse dividido","Lisa's Date with Density": "el soso romance de lisa","Hurricane Neddy": "Hurac√°n Neddy","the mysterious voyage of homer": "El viaje misterioso de nuestro Homero","The Springfield Files": "los expedientes secretos de Springfield","The Twisted World of Marge Simpson": "el turbio y oscuro mundo de marge simpson","Mountain of Madness": "La monta√±a de la locura","Simpsoncalifragilisticexpialatrocious": "Simpsoncalifragilisticoexpialidoso","The Itchy & Scratchy & Poochie Show": "Tomy, Daly y Poochie","Homer's Phobia": "La fobia de Homero","Brother from Another Series": "El hermano de otra serie","My Sister, My Sitter": "mi hermana la ni√±era","Homer vs. the Eighteenth Amendment": "Homero contra la prohibici√≥n","Grade School Confidential": "Amor en la escuela","The Canine Mutiny": "Mot√≠n canino","The Old Man and the Lisa": "El viejo y Lisa","In Marge We Trust": "En Marge confiamos","Homer's Enemy": "El enemigo de Homero","The Simpsons Spin-Off Showcase": "El repertorio de refritos de los Simpson","The Secret War of Lisa Simpson": "La guerra secreta de Lisa Simpson","The City of New York vs. Homer Simpson": "La ciudad de Nueva York vs. Homer Simpson","The Principal and the Pauper": "El doble del director","Lisa's Sax": "El sax de Lisa","The Cartridge Family": "una familia peligrosa","Bart Star": "Bart se convierte en estrella","The Two Mrs. Nahasapeemapetilons": "Las dos se√±oras Nahasapeemapetilon","Lisa the Skeptic": "Lisa la esc√©ptica","Realty Bites": "la cruda realidad","Miracle on Evergreen Terrace": "Milagro en la avenida siempreviva","All Singing, All Dancing": "Todos cantan, todos bailan","Bart Carny": "Bart en la feria","The Joy of Sect": "La secta de Springfield","Das Bus": "el autobus de la muerte","The Last Temptation of Krust": "La √∫ltima tentacion de Krusty","Dumbbell Indemnity": "el bueno, la mala y el feo","Lisa the Simpson": "Lisa Simpson","This Little Wiggy": "gorgorito","Simpson Tide": "mi querido capitan simpson","The Trouble with Trillions": "mision deducible","Girly Edition": "lisa comentarista","Trash of the Titans": "basura de titanes","King of the Hill": "El rey de la colina","Lost Our Lisa": "hemos perdido a lisa","Natural Born Kissers": "marge, puedo dormir con el peligro?","Lard of the Dance": "la sazon del baile","The Wizard of Evergreen Terrace": "El mago de la avenida siempreviva","Bart the Mother": "Bart la madre","Treehouse of Horror IX": "Especial de noche de brujas IX","When You Dish Upon a Star": "cuando se anhela una estrella","D'oh-in' in the Wind": "D'oh en el viento","Lisa Gets an A": "Lisa consigue una A","Homer Simpson in: 'Kidney Trouble'": "Homero Simpson en: Problemas renales","Mayored to the Mob": "encuentro con la mafia","Viva Ned Flanders": "Viva Ned Flanders","Wild Barts Can't Be Broken": "a un bart salvaje nadie puede destrozarlo","Sunday, Cruddy Sunday": "domingo cruel domingo","Homer to the Max": "homero al maximo","I'm with Cupid": "me acompa√±a cupido","Marge Simpson in: 'Screaming Yellow Honkers'": "el submarino amarillo","Make Room for Lisa": "un espacio para lisa","Maximum Homerdrive": "homero trabaja demasiado","Simpsons Bible Stories": "Historias b√≠blicas de los Simpson","Mom and Pop Art": "el arte de mam√° y pap√°","The Old Man and the 'C' Student": "el abuelo y el estudiante de bajas calificaciones","Monty Can't Buy Me Love": "monty no puede comprar mi amor","They Saved Lisa's Brain": "salvaron el cerebro de lisa","Thirty Minutes Over Tokyo": "Treinta minutos sobre Tokio","Beyond Blunderdome": "homero va a hollywood","Brother's Little Helper": "el cambio de bart","Guess Who's Coming to Criticize Dinner?": "adivina quien viene a criticar","Treehouse of Horror X": "Especial de noche de brujas X","E-I-E-I-(Annoyed Grunt)": "homero el granjero","Hello Gutter, Hello Fadder": "hola mam√°, hola pap√°","Eight Misbehavin'": "octillizos","Take My Wife, Sleaze": "llevate a mi esposa","Grift of the Magi": "el gran embaucador","Little Big Mom": "La peque√±a mam√°","Faith Off": "perdida de fe","The Mansion Family": "La familia mansi√≥n","Saddlesore Galactica": "jinetes galacticos","Alone Again, Natura-Diddily": "solo nuevamentirijillo","Missionary: Impossible": "Misionero Imposible","Pygmoelian": "Pigmoelion","Bart to the Future": "Bart al futuro","Days of Wine and D'oh'ses": "dias de vino y rosas","Kill the Alligator and Run": "mata al cocodrilo y huye","Last Tap Dance in Springfield": "el ultimo tango en springfield","It's a Mad, Mad, Mad, Mad Marge": "marge esta loca, loca, loca","Behind the Laughter": "Detr√°s de las risas","Treehouse of Horror XI": "Especial de noche de brujas XI","A Tale of Two Springfields": "historia de dos ciudades","Insane Clown Poppy": "Krusty el pap√°","Lisa the Tree Hugger": "Lisa la ecologista","Homer vs. Dignity": "Homero sin dignidad","The Computer Wore Menace Shoes": "amenaza informatica","The Great Money Caper": "El gran estafador","Skinner's Sense of Snow": "Skinner cubierto de nieve","HOMR": "homero","Pokey Mom": "pokemam√°","Worst Episode Ever": "El peor episodio de siempre","Tennis the Menace": "juego limpio","Day of the Jackanapes": "El d√≠a del bobalic√≥n","New Kids on the Blecch": "proyecto: idolos","Hungry, Hungry Homer": "Homero en huelga de hambre","Bye Bye Nerdie": "los motivos del abuson","Simpson Safari": "Safari Simpson","Trilogy of Error": "Trilog√≠a del error","I'm Goin' to Praiseland": "Voy a la tierra de alabanza","Children of a Lesser Clod": "Homero y los ni√±os","Simpsons Tall Tales": "relatos extraordinarios","Treehouse of Horror XII": "Especial de noche de brujas XII","The Parent Rap": "El rap de los padres","Homer the Moe": "Homero el Moe","A Hunka Hunka Burns in Love": "Burns enamorado","The Blunder Years": "Los a√±os del error","She of Little Faith": "Lisa y la fe","Brawl in the Family": "Pelea en familia","Sweets and Sour Marge": "Dulce y amarga Marge","Jaws Wired Shut": "Con la boca cerrada","Half-Decent Proposal": "Una propuesta no tan decente","The Bart Wants What It Wants": "Bart se enamora","The Lastest Gun in the West": "El √∫ltimo pistolero del oeste","The Old Man and the Key": "El abuelo y el amar","Tales from the Public Domain": "Cuentos del dominio p√∫blico","Blame It on Lisa": "La culpa es de Lisa","Weekend at Burnsie's": "Un fin de semana con Burns","Gump Roast": "Homero Forrest Gump","I Am Furious (Yellow)": "Estoy furioso (amarillo)","The Sweetest Apu": "El dulce Apu","Little Girl in the Big Ten": "La peque√±a Lisa en la universidad","The Frying Game": "El juego de la muerte","Poppa's Got a Brand New Badge": "Pap√° tiene una nueva placa","Treehouse of Horror XIII": "Especial de noche de brujas XIII","How I Spent My Strummer Vacation": "C√≥mo pas√© mis vacaciones de rock","Bart vs. Lisa vs. the Third Grade": "Bart vs. Lisa vs. tercer grado","Large Marge": "Las curvas de marge","Helter Shelter": "un nuevo hogar","The Great Louse Detective": "El gran detective","Special Edna": "La especial Edna","The Dad Who Knew Too Little": "El pap√° que sab√≠a muy poco","The Strong Arms of the Ma": "Los fuertes brazos de mam√°","Pray Anything": "Reza cualquier cosa","Barting Over": "Bart se independiza","I'm Spelling as Fast as I Can": "Deletreo veloz","A Star Is Born Again": "Una estrella nace de nuevo","Mr. Spritz Goes to Washington": "krusty va a Washington","C.E. D'oh": "Director ejecutivo Homero","'Scuse Me While I Miss the Sky": "reencuentro con el firmamento","Three Gays of the Condo": "Tres gays en un condominio","Dude, Where's My Ranch?": "Amigo, ¬ød√≥nde est√° mi rancho?","Old Yeller-Belly": "El cobarde amarillo","Brake My Wife, Please": "Para a mi esposa, por favor","The Bart of War": "El Bart de la guerra","Moe Baby Blues": "El blues del beb√© de Moe","Treehouse of Horror XIV": "Especial de noche de brujas XIV","My Mother the Carjacker": "Mi madre la ladrona de autos","The President Wore Pearls": "La presidenta con perlas","The Regina Monologues": "Los mon√≥logos de la reina","The Fat and the Furriest": "El gordo y el peludo","Today, I Am a Clown": "Hoy soy un payaso","Tis the Fifteenth Season": "Es la decimoquinta temporada","Marge vs. Singles, Seniors, Childless Couples and Teens, and Gays": "Marge vs. todos","I, D'oh-Bot": "Yo, Homero robot","Diatribe of a Mad Housewife": "La diatriba de una ama de casa","Margical History Tour": "El tour hist√≥rico de Marge","Milhouse Doesn't Live Here Anymore": "Milhouse ya no vive aqu√≠","Smart and Smarter": "Lista y m√°s lista","The Ziff Who Came to Dinner": "El Ziff que vino a cenar","Co-Dependent's Day": "El d√≠a del codependiente","The Wandering Juvie": "El delincuente errante","My Big Fat Geek Wedding": "Mi gran boda geek","Catch 'Em If You Can": "Atr√°pame si puedes","Simple Simpson": "Simpson simple","The Way We Weren't": "nuestros a√±os infelices","Bart-Mangled Banner": "La bandera destrozada de Bart","Fraudcast News": "Noticias fraudulentas","Treehouse of Horror XV": "Especial de noche de brujas XV","All's Fair in Oven War": "Todo es justo en el amor y en la cocina","Sleeping with the Enemy": "Durmiendo con el enemigo","She Used to Be My Girl": "Ella sol√≠a ser mi chica","Fat Man and Little Boy": "El hombre gordo y el ni√±o peque√±o","Midnight Rx": "Medicamentos de medianoche","Mommie Beerest": "Mam√° osa","Homer and Ned's Hail Mary Pass": "El pase salvador de Homero y Ned","Pranksta Rap": "el rap del bromista","There's Something About Marrying": "el amor es ciego","On a Clear Day I Can't See My Sister": "lejos de mi hermana","Goo Goo Gai Pan": "aventura en china","Mobile Homer": "la casa rodante de homero","The Seven-Beer Snitch": "El informante de las siete cervezas","Future-Drama": "Futudrama","Don't Fear the Roofer": "ray el contratista","The Heartbroke Kid": "El chico con el coraz√≥n roto","A Star Is Torn": "Una estrella destrozada","Thank God It's Doomsday": "el dia del juicio","Home Away from Homer": "un hogar lejos de homero","The Father, the Son, and the Holy Guest Star": "El padre, el hijo y el ilustre invitado","Bonfire of the Manatees": "La hoguera de los manat√≠es","The Girl Who Slept Too Little": "La chica que dormia muy poco","Milhouse of Sand and Fog": "Milhouse de arena y niebla","Treehouse of Horror XVI": "Especial de noche de brujas XVI","marge¬¥s son poisoning": "el envenenamiento del hijo de marge","see homer run": "homero se postula","the last of the red hat mamas": "los dulces tomates rojos","The Italian Bob": "Bob el italiano","Simpsons Christmas Stories": "Historias navide√±as de los Simpson","Homer's Paternity Coot": "el padre de Homero","We're on the Road to D'ohwhere": "Vamos camino al D'oh","My Fair Laddy": "Mi bello jardinero","The Seemingly Never-Ending Story": "La historia aparentemente interminable","Bart Has Two Mommies": "Bart tiene dos mam√°s","Homer Simpson, This Is Your Wife": "Homero esta es tu esposa","Million-Dollar Abie": "El abuelo millonario","Kiss Kiss Bang Bangalore": "adios en la india","The Wettest County in the World": "las historias mas mojadas jamas contadas","Girls Just Want to Have Sums": "Las chicas solo quieren sumar","Regarding Margie": "En cuanto a Marge","The Monkey Suit": "El traje de mono","Marge and Homer Turn a Couple Play": "juego de parejas con marge y homero"
};

const diccionario = {
    "S01E01":"Especial de Navidad de los Simpson","S01E02":"Bart es un genio","S01E03":"La odisea de Homero","S01E04":"La familia va a terapia","S01E05":"Bart el General","S01E06":"La depresi√≥n de Lisa","S01E07":"La llamada de los Simpson","S01E08":"El h√©roe sin cabeza","S01E09":"Un momento de decisi√≥n","S01E10":"La noche de fiesta de Homero","S01E11":"Intercambio cultural","S01E12":"Krusty va a la c√°rcel","S01E13":"Una noche encantadora",
    "S02E01":"Bart reprueba","S02E02":"simpson y dalilah","S02E03":"Especial de noche de brujas","S02E04":"Dos coches en cada garaje y tres ojos en cada pez","S02E05":"Homero el animador","S02E06":"la sociedad de los golfistas muertos","S02E07":"Bart en el d√≠a de gracias","S02E08":"Bart el temerario","S02E09":"Tomy, Daly y Marge","S02E10":"Bart es atropellado","S02E11":"Aviso de muerte","S02E12":"los a√±os que vivimos","S02E13":"no robaras","S02E14":"El director encantador","S02E15":"¬øD√≥nde est√°s hermano m√≠o?","S02E16":"El perro de bart reprueba","S02E17":"nuestros a√±os felices","S02E18":"Pinceles de grandeza","S02E19":"El sustituto de Lisa","S02E20":"La guerra de los Simpson","S02E21":"Tres hombres y una historieta","S02E22":"Sangre nueva",
    "S03E01":"Pap√° est√° loco","S03E02":"El patriotismo de Lisa","S03E03":"Cuando Flanders fracas√≥","S03E04":"El peque√±o padrino","S03E05":"homero al diccionario","S03E06":"De tal palo tal payaso","S03E07":"Especial de noche de brujas II","S03E08":"El pony de Lisa","S03E09":"S√°bados de trueno","S03E10":"Llamarada Moe","S03E11":"Burns y los alemanes","S03E12":"Me cas√© con Marge","S03E13":"bart y la radio","S03E14":"los pronosticos de lisa","S03E15":"Homero se queda solo","S03E16":"Bart el amante","S03E17":"Homero al bat","S03E18":"Vocaciones distintas","S03E19":"nuestro mejor amigo","S03E20":"Homero el campirano","S03E21":"El viudo negro","S03E22":"El rock de Otto","S03E23":"milhouse se enamora",
    "S04E01":"Kampamento Krusty","S04E02":"Un tranv√≠a llamado Marge","S04E03":"Homero el hereje","S04E04":"Lisa la reina de la belleza","S04E05":"Especial de noche de brujas III","S04E06":"tomy y daly: La pel√≠cula","S04E07":"Marge consigue un empleo","S04E08":"La chica nueva","S04E09":"Don Barredora","S04E10":"La primera palabra de lisa","S04E11":"El gran coraz√≥n de Homero","S04E12":"Marge contra el monorriel","S04E13":"La elecci√≥n de Selma","S04E14":"Hermano menor, hermano mayor","S04E15":"Yo amo a Lisa","S04E16":"la promesa","S04E17":"La √∫ltima salida a Springfield","S04E18":"A esto hemos llegado","S04E19":"El intermedio","S04E20":"El d√≠a del garrote","S04E21":"Marge en cadenas","S04E22":"El drama de Krusty",
    "S05E01":"El cuarteto de Homero","S05E02":"Cabo de miedosos","S05E03":"Homero va a la universidad","S05E04":"El oso de Burns","S05E05":"Especial de noche de brujas IV","S05E06":"Marge la rebelde","S05E07":"Filosof√≠a bartiana","S05E08":"Exploradores a la fuerza","S05E09":"La √∫ltima tentaci√≥n de Homero","S05E10":"Springfield pr√≥spero","S05E11":"Homero el vigilante","S05E12":"Bart se hace famoso","S05E13":"Homero y apu","S05E14":"Lisa contra la Baby Malib√∫","S05E15":"Homero en el espacio profundo","S05E16":"homero ama a flanders","S05E17":"bart gana un elefante","S05E18":"el heredero de burns","S05E19":"la cancion de skinner","S05E20":"El ni√±o que sabia demasiado","S05E21":"el amante de lady bouvier",
    "S06E01":"el diabolico bart","S06E02":"La rival de Lisa","S06E03":"recuerdos de amor","S06E04":"La tierra de Tomy y Daly","S06E05":"El regreso de Bob Pati√±o","S06E06":"Especial de noche de brujas V","S06E07":"La novia de Bart","S06E08":"Lisa y los deportes","S06E09":"Homero el malo","S06E10":"El abuelo contra la impotencia sexual","S06E11":"Miedo a volar","S06E12":"Homero el Grande","S06E13":"y con maggie son tres","S06E14":"El cometa de Bart","S06E15":"Homero el payaso","S06E16":"Bart contra Australia","S06E17":"Homero contra Patty y Selma","S06E18":"Una estrella estrellada","S06E19":"La boda de Lisa","S06E20":"Un galgo llamado Monty","S06E21":"lucha educativa","S06E22":"por la cuidad de springfield","S06E23":"contacto en springfield","S06E24":"el limonero de troya","S06E25":"quien mato al se√±or burns parte uno",
    "S07E01":"Qui√©n mat√≥ al Sr. Burns parte dos","S07E02":"hombre radioactivo","S07E03":"Hogar dulce hogarcirijillo","S07E04":"Bart vende su alma","S07E05":"Lisa la vegetariana","S07E06":"Especial de noche de brujas VI","S07E07":"Homero tama√±o familiar","S07E08":"Mam√° simpson","S07E09":"la ultima carcajada de Bob Pati√±o","S07E10":"El espectacular episodio 138 de los Simpson","S07E11":"El beb√© de mam√°","S07E12":"El equipo de Homero","S07E13":"malos vecinos","S07E14":"lucha de clases en Springfield","S07E15":"Bart el sopl√≥n","S07E16":"Lisa la iconoclasta","S07E17":"Homero el Smithers","S07E18":"El d√≠a que muri√≥ la violencia","S07E19":"Un pez llamado Selma","S07E20":"Bart recorre el mundo","S07E21":"22 peliculas cortas sobre springfield","S07E22":"Mi h√©roe el abuelo","S07E23":"y donde esta el inmigrante?","S07E24":"Homeropalooza","S07E25":"Verano de metro y medio",
    "S08E01":"Especial de noche de brujas VII","S08E02":"Solo se muda dos veces","S08E03":"Homero por el campeonato","S08E04":"papi burns","S08E05":"bart de noche","S08E06":"Milhouse dividido","S08E07":"el soso romance de lisa","S08E08":"Hurac√°n Neddy","S08E09":"el viaje misterioso de nuestro homero","S08E10":"los expedientes secretos de springfield","S08E11":"el turbio y oscuro mundo de marge simpson","S08E12":"La monta√±a de la locura","S08E13":"simpsoncalifrajilisticoespialidoso","S08E14":"tomy y daly y poochie","S08E15":"La fobia de Homero","S08E16":"el hermano de otra serie","S08E17":"mi hermana la ni√±era","S08E18":"homero contra la prohibicion","S08E19":"amor en la escuela","S08E20":"motin canino","S08E21":"el viejo y la lisa","S08E22":"preguntale a marge","S08E23":"El enemigo de Homero","S08E24":"reperterio de refritos","S08E25":"La guerra secreta de Lisa Simpson",
    "S09E01":"La ciudad de Nueva York vs. Homero Simpson","S09E02":"El doble del director","S09E03":"El sax de Lisa","S09E04":"Especial de noche de brujas VIII","S09E05":"Una familia peligrosa","S09E06":"Bart se convierte en estrella","S09E07":"Las dos se√±oras Nahasapeemapetilon","S09E08":"Lisa la esc√©ptica","S09E09":"La cruda realidad","S09E10":"Milagro en la avenida siempreviva","S09E11":"Todos cantan, todos bailan","S09E12":"Bart en la feria","S09E13":"La secta de Springfield","S09E14":"El autob√∫s de la muerte","S09E15":"La √∫ltima tentaci√≥n de Krusty","S09E16":"El bueno, la mala y el feo","S09E17":"Lisa Simpson","S09E18":"Gorgorito","S09E19":"Mi querido capit√°n Simpson","S09E20":"Misi√≥n deducible","S09E21":"Lisa comentarista","S09E22":"Basura de titanes","S09E23":"El rey de la colina","S09E24":"Hemos perdido a Lisa","S09E25":"Marge, ¬øpuedo dormir con el peligro?",
    "S10E01":"La saz√≥n del baile","S10E02":"El mago de la avenida siempreviva","S10E03":"Bart la madre","S10E04":"Especial de noche de brujas IX","S10E05":"Cuando se anhela una estrella","S10E06":"D'oh en el viento","S10E07":"Lisa consigue una A","S10E08":"Homero Simpson en: Problemas renales","S10E09":"Encuentro con la mafia","S10E10":"Viva Ned Flanders","S10E11":"A un Bart salvaje nadie puede destrozarlo","S10E12":"Domingo cruel domingo","S10E13":"Homero al m√°ximo","S10E14":"Me acompa√±a Cupido","S10E15":"El submarino amarillo","S10E16":"Un espacio para Lisa","S10E17":"Homero trabaja demasiado","S10E18":"Historias b√≠blicas de los Simpson","S10E19":"El arte de mam√° y pap√°","S10E20":"El abuelo y el estudiante de bajas calificaciones","S10E21":"Monty no puede comprar mi amor","S10E22":"Salvaron el cerebro de Lisa","S10E23":"Treinta minutos sobre Tokio",
    "S11E01":"Homero va a Hollywood","S11E02":"El cambio de Bart","S11E03":"Adivina qui√©n viene a criticar","S11E04":"Especial de noche de brujas X","S11E05":"Homero el granjero","S11E06":"Hola mam√°, hola pap√°","S11E07":"Octillizos","S11E08":"Ll√©vate a mi esposa","S11E09":"El gran embaucador","S11E10":"La peque√±a mam√°","S11E11":"P√©rdida de fe","S11E12":"La familia mansi√≥n","S11E13":"Jinetes gal√°cticos","S11E14":"Solo nuevamentirijillo","S11E15":"Misionero Imposible","S11E16":"Pigmoelion","S11E17":"Bart al futuro","S11E18":"D√≠as de vino y rosas","S11E19":"Mata al cocodrilo y huye","S11E20":"El √∫ltimo tango en Springfield","S11E21":"Marge est√° loca, loca, loca","S11E22":"Detr√°s de las risas",
    "S12E01":"Especial de noche de brujas XI","S12E02":"El nuevo Springfield","S12E03":"Krusty el pap√°","S12E04":"Lisa la ecologista","S12E05":"Homero sin dignidad","S12E06":"amenaza informatica","S12E07":"El gran estafador","S12E08":"Skinner cubierto de nieve","S12E09":"El verdadero Homero","S12E10":"pokemam√°","S12E11":"El peor episodio de siempre","S12E12":"Tenis peligroso","S12E13":"El d√≠a del bobalic√≥n","S12E14":"proyecto idolos","S12E15":"Homero en huelga de hambre","S12E16":"los motivos del abuson","S12E17":"Safari Simpson","S12E18":"Trilog√≠a del error","S12E19":"Veneracion a la homero","S12E20":"Homero y los ni√±os","S12E21":"relatos extraordinarios",
    "S13E01":"Especial de noche de brujas XII","S13E02":"El rap de los padres","S13E03":"Homero el Moe","S13E04":"Burns enamorado","S13E05":"Los a√±os del error","S13E06":"Lisa y la fe","S13E07":"Pelea en familia","S13E08":"Dulce y amarga Marge","S13E09":"Con la boca cerrada","S13E10":"Una propuesta no tan decente","S13E11":"Bart se enamora","S13E12":"El √∫ltimo pistolero del oeste","S13E13":"El abuelo y el amar","S13E14":"Cuentos del dominio p√∫blico","S13E15":"La culpa es de Lisa","S13E16":"Un fin de semana con Burns","S13E17":"Homero Forrest Gump","S13E18":"Estoy furioso (amarillo)","S13E19":"El dulce Apu","S13E20":"La peque√±a Lisa en la universidad","S13E21":"El juego de la muerte","S13E22":"Pap√° tiene una nueva placa",
    "S14E01":"Especial de noche de brujas XIII","S14E02":"C√≥mo pas√© mis vacaciones de rock","S14E03":"Bart vs. Lisa vs. tercer grado","S14E04":"Las curvas de marge","S14E05":"un nuevo hogar","S14E06":"El gran detective","S14E07":"La especial Edna","S14E08":"El pap√° que sab√≠a muy poco","S14E09":"Los fuertes brazos de mam√°","S14E10":"Reza cualquier cosa","S14E11":"Bart se independiza","S14E12":"Deletreo veloz","S14E13":"Una estrella nace de nuevo","S14E14":"Krusty va a Washington","S14E15":"Director ejecutivo Homero","S14E16":"reencuentro con el firmamento","S14E17":"Tres gays en un condominio","S14E18":"Amigo, ¬ød√≥nde est√° mi rancho?","S14E19":"El cobarde amarillo","S14E20":"Para a mi esposa, por favor","S14E21":"El Bart de la guerra","S14E22":"El blues del beb√© de Moe",
    "S15E01":"Especial de noche de brujas XIV","S15E02":"Mi madre la ladrona de autos","S15E03":"La presidenta con perlas","S15E04":"Los mon√≥logos de la reina","S15E05":"El gordo y el peludo","S15E06":"Hoy soy un payaso","S15E07":"Es la decimoquinta temporada","S15E08":"Marge vs. todos","S15E09":"Yo, robot","S15E10":"La diatriba de una ama de casa","S15E11":"El tour hist√≥rico de Marge","S15E12":"Milhouse ya no vive aqu√≠","S15E13":"Lista y m√°s lista","S15E14":"El Ziff que vino a cenar","S15E15":"El d√≠a del codependiente","S15E16":"El delincuente errante","S15E17":"Mi gran boda geek","S15E18":"Atr√°pame si puedes","S15E19":"el simple simpson","S15E20":"nuestros a√±os infelices","S15E21":"La bandera destrozada de Bart","S15E22":"Noticias fraudulentas",
    "S16E01":"Especial de noche de brujas XV","S16E02":"Todo es justo en el amor y en la cocina","S16E03":"Durmiendo con el enemigo","S16E04":"Ella era mi amiga","S16E05":"El hombre gordo y el ni√±o peque√±o","S16E06":"Medicamentos de medianoche","S16E07":"La mam√° cerveza","S16E08":"El pase salvador de Homero y Ned","S16E09":"el rap del bromista","S16E10":"el amor es ciego","S16E11":"lejos de mi hermana","S16E12":"aventura en china","S16E13":"la casa rodante de homero","S16E14":"El informante de las siete cervezas","S16E15":"Futudrama","S16E16":"ray el contratista","S16E17":"El chico con el coraz√≥n roto","S16E18":"Una estrella destrozada","S16E19":"Gracias a Dios es el fin del mundo","S16E20":"Homero lejos de casa","S16E21":"El padre, el hijo y el ilustre invitado",
    "S17E01":"la hoguera de los manaties","S17E02":"La ni√±a que dormia muy poco","S17E03":"Milhouse de arena y niebla","S17E04":"Especial de noche de brujas XVI","S17E05":"el envenenamiento del hijo de marge","S17E06":"homero se postula","S17E07":"los dulces tomates rojos","S17E08":"bob el italiano","S17E09":"Historias navide√±as de los Simpson","S17E10":"el padre de homero","S17E11":"en el camino al do¬¥h","S17E12":"mi bello jardinero","S17E13":"historia aparentemente sin final","S17E14":"bart tiene dos mam√°s","S17E15":"homero esta es tu esposa","S17E16":"el abuelo del millon de dolares","S17E17":"adios a la india","S17E18":"las historias mas mojadas jamas contadas","S17E19":"las chicas solo quieren sumar","S17E20":"hablando de marge","S17E21":"el traje de simio","S17E22":"juego de parejas con marge y homero"
};

const todosTitulos = [...new Set(Object.values(diccionario))];
let score = 0, lives = 5, respuestaCorrecta = "", juegoActivo = false;
let nombreJugador = "";
let tituloEnActual = "";

// ‚îÄ‚îÄ‚îÄ SINOPSIS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function mostrarSinopsis(tituloEn) {
    const box = document.getElementById('sinopsis-box');
    const texto = document.getElementById('sinopsis-texto');
    box.style.display = 'none';
    texto.innerText = '';
    if (!tituloEn) return;
    try {
        const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(tituloEn)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error();
        const data = await res.json();
        const extracto = data?.extract;
        if (!extracto) throw new Error();
        const corto = extracto.length > 280 ? extracto.substring(0, 280).trimEnd() + '‚Ä¶' : extracto;
        texto.innerText = corto;
        box.style.display = 'block';
    } catch (e) {
        // Sin sinopsis: no mostramos nada
    }
}

// ‚îÄ‚îÄ‚îÄ NOMBRE DE JUGADOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function confirmarNombre() {
    const inp = document.getElementById('name-screen-input');
    const nombre = inp.value.trim();
    if (!nombre) { inp.style.borderColor = 'var(--red)'; inp.focus(); return; }
    nombreJugador = nombre;
    document.getElementById('name-screen').style.display = 'none';
    actualizarPlayerTag();
    juegoActivo = true;
    nuevaPregunta();
    cargarRanking();
}

function actualizarPlayerTag() {
    document.getElementById('player-tag').innerHTML =
        `Jugando como: <span style="color:var(--yellow);font-weight:900;">${escapeHtml(nombreJugador)}</span>
        <button onclick="cambiarNombre()" style="background:none;border:none;color:#555;font-size:0.7rem;cursor:pointer;text-decoration:underline;margin-left:4px;">cambiar</button>`;
}

function cambiarNombre() {
    const nuevo = prompt("¬øNuevo nombre?", nombreJugador);
    if (nuevo && nuevo.trim()) {
        nombreJugador = nuevo.trim().substring(0, 18);
        actualizarPlayerTag();
        document.getElementById('nombre-input').value = nombreJugador;
    }
}

// ‚îÄ‚îÄ‚îÄ RANKING ONLINE (JSONBin) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function leerEntries() {
    const res = await fetch(BIN_URL + '/latest', {
        method: 'GET',
        headers: { 'X-Master-Key': JSONBIN_KEY, 'X-Bin-Meta': 'false' }
    });
    if (!res.ok) { console.warn('leerEntries status:', res.status); return []; }
    const data = await res.json();
    const arr = Array.isArray(data) ? data : (Array.isArray(data.record) ? data.record : []);
    return arr.filter(e => e && typeof e.name === 'string' && typeof e.score === 'number');
}

async function escribirEntries(entries) {
    const res = await fetch(BIN_URL, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_KEY },
        body: JSON.stringify(entries)
    });
    if (!res.ok) { const txt = await res.text(); throw new Error(`PUT ${res.status}: ${txt}`); }
}

async function cargarRanking() {
    try { renderRanking(await leerEntries()); }
    catch (e) { renderRanking([]); }
}

async function guardarPuntaje(nombre, pts) {
    if (!pts || pts <= 0) return;
    const statusEl = document.getElementById('save-status');
    statusEl.style.color = '#aaa';
    statusEl.innerText = '‚è≥ Guardando...';
    try {
        let entries = await leerEntries();
        entries.push({ name: nombre.trim(), score: pts, date: Date.now() });
        entries.sort((a, b) => b.score - a.score);
        entries = entries.slice(0, MAX_ENTRIES);
        await escribirEntries(entries);
        renderRanking(entries);
        statusEl.style.color = '#4CAF50';
        statusEl.innerText = '‚úÖ ¬°Puntaje guardado!';
    } catch (e) {
        statusEl.style.color = 'var(--red)';
        statusEl.innerText = '‚ùå Error: ' + e.message;
    }
}

function renderRanking(entries) {
    const lista = document.getElementById('rank-list');
    if (!entries.length) {
        lista.innerHTML = '<li style="text-align:center;color:#555;font-size:0.8rem;padding:20px 0;">¬°S√© el primero!</li>';
        return;
    }
    const posColors = ['#FFD700', '#C0C0C0', '#CD7F32'];
    lista.innerHTML = entries.map((e, i) => {
        const posStyle = i < 3 ? `color:${posColors[i]};` : 'color:#888;';
        const posIcon = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `${i + 1}.`;
        return `<li style="display:flex;align-items:center;gap:8px;padding:7px 4px;border-bottom:1px solid rgba(255,255,255,0.06);font-size:0.82rem;font-weight:700;">
            <span style="font-family:'Bangers',cursive;font-size:1rem;width:26px;text-align:center;flex-shrink:0;${posStyle}">${posIcon}</span>
            <span style="flex:1;color:#eee;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${escapeHtml(e.name)}</span>
            <span style="font-family:'Bangers',cursive;font-size:1rem;color:var(--yellow);flex-shrink:0;">${e.score}</span>
        </li>`;
    }).join('');
}

function escapeHtml(str) {
    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
}

// ‚îÄ‚îÄ‚îÄ L√ìGICA DEL JUEGO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function traducir(titulo_en, codigo) {
    if (titulo_en && traduccion[titulo_en]) return traduccion[titulo_en];
    if (codigo && diccionario[codigo]) return diccionario[codigo];
    return titulo_en || codigo;
}

function normalizar(str) {
    return str.toLowerCase().normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '').replace(/[^a-z0-9\s]/g, '').replace(/\s+/g, ' ').trim();
}

function mezclar(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
}

function generarOpciones(correcta) {
    const pool = todosTitulos.filter(t => normalizar(t) !== normalizar(correcta));
    return mezclar([correcta, ...mezclar(pool).slice(0, 3)]);
}

function mostrarOpciones(opciones) {
    document.getElementById('opciones-grid').innerHTML = opciones.map((op, i) =>
        `<button class="opcion-btn" id="opcion-${i}" onclick="elegir(${i})">${op}</button>`
    ).join('');
}

let opcionesActuales = [];
let respondido = false;

function elegir(idx) {
    if (respondido) return;
    respondido = true;

    const elegida = opcionesActuales[idx];
    const f = document.getElementById('feedback');

    opcionesActuales.forEach((_, i) => {
        const btn = document.getElementById(`opcion-${i}`);
        btn.disabled = true;
        if (normalizar(opcionesActuales[i]) === normalizar(respuestaCorrecta)) btn.classList.add('revelar');
    });

    if (normalizar(elegida) === normalizar(respuestaCorrecta)) {
        document.getElementById(`opcion-${idx}`).classList.add('correcto');
        score += 10;
        document.getElementById('score').innerText = score;
        f.innerText = "¬°PERFECTIRIJILLO! ‚ú®";
        f.style.color = "var(--yellow)";
        mostrarSinopsis(tituloEnActual);
        setTimeout(nuevaPregunta, 4000);
    } else {
        document.getElementById(`opcion-${idx}`).classList.add('incorrecto');
        lives--;
        actualizarVidas();
        f.innerHTML = `¬°D'OH! Era la correcta üëÜ`;
        f.style.color = "var(--red)";
        mostrarSinopsis(tituloEnActual);
        if (lives <= 0) setTimeout(finalizarJuego, 4000);
        else setTimeout(nuevaPregunta, 4500);
    }
}

async function nuevaPregunta() {
    if (!juegoActivo) return;
    respondido = false;

    document.getElementById('sinopsis-box').style.display = 'none';
    document.getElementById('sinopsis-texto').innerText = '';

    const loader = document.getElementById('loader'), img = document.getElementById('episode-img');
    loader.innerText = "SINTONIZANDO..."; loader.style.display = "block";
    loader.style.animation = "blink 0.8s step-start infinite"; loader.style.color = "var(--yellow)";
    img.style.display = "none";
    document.getElementById('opciones-grid').innerHTML = "";
    document.getElementById('feedback').innerText = "";

    const codigos = Object.keys(diccionario);
    const codigo = codigos[Math.floor(Math.random() * codigos.length)];

    try {
        const res = await fetch(`/api/frinkiac?episode=${codigo}`);
        if (!res.ok) throw new Error();
        const data = await res.json();
        tituloEnActual = data.titulo_en || "";
        respuestaCorrecta = traducir(data.titulo_en, data.Frame.Episode);

        const imgUrl = `/api/imagen?episode=${data.Frame.Episode}&timestamp=${data.Frame.Timestamp}`;
        img.onload = () => {
            loader.style.display = "none"; img.style.display = "block";
            opcionesActuales = generarOpciones(respuestaCorrecta);
            mostrarOpciones(opcionesActuales);
        };
        img.onerror = () => {
            loader.innerText = "‚ùå ERROR DE SE√ëAL"; loader.style.animation = "none"; loader.style.color = "var(--red)";
        };
        img.src = imgUrl;
    } catch (e) {
        loader.innerText = "‚ùå ERROR DE SE√ëAL"; loader.style.animation = "none"; loader.style.color = "var(--red)";
    }
}

function actualizarVidas() { document.getElementById('lives').innerText = "üç©".repeat(Math.max(0, lives)); }

function finalizarJuego() {
    juegoActivo = false;
    document.getElementById('nombre-input').value = nombreJugador;
    document.getElementById('save-status').innerText = '';
    document.getElementById('game-over-overlay').style.display = "flex";
    document.getElementById('final-score').innerText = score;
}

function guardarYReiniciar() {
    const nombre = document.getElementById('nombre-input').value.trim() || nombreJugador || "An√≥nimo";
    nombreJugador = nombre.substring(0, 18);
    actualizarPlayerTag();
    guardarPuntaje(nombreJugador, score).then(() => {
        setTimeout(reiniciarJuego, 1500);
    });
}

function terminarPartida() {
    if (!juegoActivo && score === 0) return;
    juegoActivo = false;
    respondido = true;
    document.querySelectorAll('.opcion-btn').forEach(b => b.disabled = true);
    document.getElementById('nombre-input').value = nombreJugador;
    document.getElementById('save-status').innerText = '';
    document.getElementById('game-over-overlay').style.display = "flex";
    document.getElementById('final-score').innerText = score;
}

function reiniciarJuego() {
    score = 0; lives = 5; juegoActivo = true; respondido = false;
    document.getElementById('score').innerText = "0";
    actualizarVidas();
    document.getElementById('sinopsis-box').style.display = 'none';
    document.getElementById('game-over-overlay').style.display = "none";
    nuevaPregunta();
}

document.getElementById('name-screen-input').focus();
cargarRanking();
</script>
</body>
</html>
